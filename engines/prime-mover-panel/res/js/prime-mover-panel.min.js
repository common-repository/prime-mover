!function(p){p(function(){m.initializeAutoBackupBlogSelector(),m.deleteAllBackups(),m.computeBackupDirSize(),m.showHideAuthorizationKeys(),m.showHideGDriveCredentials(),m.toggleDropBoxToken(),m.toggleEncryptionKey(),m.toggleMySQLDumpConfigPath(),m.clearLogs(),m.initializeAjaxHandlers(),m.resetToDefaults(),m.generateAuthorizationKey(),m.copyKeyToClipBoard(),m.copyEncryptionKeyToClipBoard(),m.slideTogglerActivatedPlugins()});var m={initializeData:[{button_selector:"#js-save-prime_mover_dbdump_batchsize",spinner_selector:".js-save-prime_mover_dbdump_batchsize-spinner",data_selector:"#js-prime_mover_dbdump_batchsize",ajax_action:"prime_mover_dbdump_batchsize",ajax_key:"prime_mover_dbdump_batchsize_key",datatype:"text",dialog:!1},{button_selector:"#js-save-prime_mover_searchreplace_batchsize",spinner_selector:".js-save-prime_mover_searchreplace_batchsize-spinner",data_selector:"#js-prime_mover_searchreplace_batchsize",ajax_action:"prime_mover_searchreplace_batchsize",ajax_key:"prime_mover_searchreplace_batchsize_key",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-upload-chunk-size",spinner_selector:".js-save-prime-mover-upload-chunk-size-spinner",data_selector:"#js-prime_mover_upload_chunksize",ajax_action:"prime_mover_save_uploadchunksize_settings",ajax_key:"uploadchunksize",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-enable-js-uploadlog",spinner_selector:".js-save-prime-mover-enable-js-uploadlog-spinner",data_selector:"#js-prime_mover_enable_js_uploadlog_checkbox",ajax_action:"prime_mover_save_uploadjs_troubleshooting_setting",ajax_key:prime_mover_control_panel_renderer.enable_uploadjs_troubleshooting,datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-enable-turbomode",spinner_selector:".js-save-prime-mover-enable-turbomode-spinner",data_selector:"#js-prime_mover_enable_js_turbomode_checkbox",ajax_action:"prime_mover_save_turbomode_setting",ajax_key:prime_mover_control_panel_renderer.enable_turbo_mode,datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-enable-js-log",spinner_selector:".js-save-prime-mover-enable-js-log-spinner",data_selector:"#js-prime_mover_enable_js_log_checkbox",ajax_action:"prime_mover_save_js_troubleshooting_settings",ajax_key:prime_mover_control_panel_renderer.enable_js_troubleshooting,datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-persist-troubleshooting",spinner_selector:".js-save-prime-mover-persist-troubleshooting-spinner",data_selector:"#js-prime_mover_persist_log_checkbox",ajax_action:"prime_mover_save_persist_troubleshooting_settings",ajax_key:prime_mover_control_panel_renderer.enable_persist_troubleshooting,datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-troubleshooting",spinner_selector:".js-save-prime-mover-troubleshooting-spinner",data_selector:"#js-prime_mover_enable_log_checkbox",ajax_action:"prime_mover_save_troubleshooting_settings",ajax_key:prime_mover_control_panel_renderer.enable_troubleshooting,datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-dropbox-access-token",spinner_selector:".js-save-prime-mover-dropbox-access-token-spinner",data_selector:"#js-prime_mover_dropbox_access_key",ajax_action:"prime_mover_save_dropbox_settings",ajax_key:"dropbox_access_token",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-encryption-key",spinner_selector:".js-save-prime-mover-encryption-key-spinner",data_selector:"#js-prime_mover_encryption_key_panel",ajax_action:"prime_mover_write_key_to_config",ajax_key:"prime_mover_encryption_ajax_key",datatype:"text",dialog:!0,dialog_selector:"#js-prime-mover-panel-enc-warn-dialog",dialog_button_text:prime_mover_control_panel_renderer.prime_mover_update_enc_key_button},{button_selector:"#js-save-prime-mover-excluded-plugins",spinner_selector:".js-save-prime-mover-excluded-plugins-spinner",data_selector:"#js-prime-mover-excluded-plugins",ajax_action:"prime_mover_excluded_plugins",ajax_key:"text_area_data",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-excluded-uploads",spinner_selector:".js-save-prime-mover-excluded-uploads-spinner",data_selector:"#js-prime-mover-excluded-uploads",ajax_action:"prime_mover_excluded_uploads",ajax_key:"text_area_data",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-custom-basebackup-dir",spinner_selector:".js-prime_mover_basedirsettings_spinner",data_selector:"#js-prime_mover_user_backup_dir_setting",ajax_action:"prime_mover_save_custom_baseabackup_dir",ajax_key:"custom_path",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-maintenance-mode",spinner_selector:".js-prime_mover_maintenance-mode-spinner",data_selector:"#js-prime_mover_enable_maintenance_mode",ajax_action:"prime_mover_save_maintenance_mode_setting",ajax_key:"turn_off_maintenance",datatype:"checkbox",dialog:!1},{button_selector:"#js-save-prime-mover-download-authentication",spinner_selector:".js-prime_mover_download_authentication-spinner",data_selector:"#js-prime-mover-authorized-domains",ajax_action:"prime_mover_save_download_authentication",ajax_key:"text_area_data",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-gdrive-setting",spinner_selector:".js-prime_mover_gdrive_setting-spinner",data_selector:"#js-prime-mover-gdrive-settings",ajax_action:"prime_mover_save_gdrive_setting",ajax_key:"text_area_data",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-refreshinterval-size",spinner_selector:".js-save-prime-mover-upload-refreshinterval-spinner",data_selector:"#js-prime_mover_upload_refreshinterval",ajax_action:"prime_mover_save_upload_refresh_interval",ajax_key:"refresh_interval_setting",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-upload-retrylimit",spinner_selector:".js-save-prime-mover-upload-retrylimit-spinner",data_selector:"#js-prime_mover_upload_retrylimit",ajax_action:"prime_mover_save_upload_retrylimit",ajax_key:"upload_retry_limit",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-dropbox-chunk-size",spinner_selector:".js-save-prime-mover-dropbox-chunk-size-spinner",data_selector:"#js-prime_mover_dropbox_chunksize",ajax_action:"prime_mover_save_dropbox_chunksize_setting",ajax_key:"dropbox_chunk_upload_size",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-gdrive-chunk-size",spinner_selector:".js-save-prime-mover-gdrive-chunk-size-spinner",data_selector:"#js-prime_mover_gdrive_chunksize",ajax_action:"prime_mover_save_gdrive_chunksize_setting",ajax_key:"gdrive_chunk_upload_size",datatype:"text",dialog:!1},{button_selector:"#js-save-prime-mover-gdrivedownload-chunk-size",spinner_selector:".js-save-prime-mover-gdrivedownload-chunk-size-spinner",data_selector:"#js-prime_mover_gdrivedownload_chunksize",ajax_action:"prime_mover_save_gdrivedownload_chunksize_setting",ajax_key:"gdrive_chunk_download_size",datatype:"text",dialog:!1}],initializeAjaxHandlers:function(){var e=this.initializeData,o=prime_mover_control_panel_renderer.prime_mover_settings_js_api,e=e.concat(o);p.each(e,function(e,i){p("body").on("click",i.button_selector,function(){var e,o=i.spinner_selector;"text"===i.datatype&&(e=p(i.data_selector).val()),"checkbox"===i.datatype&&(e=!1,p(i.data_selector).is(":checked")&&(e=!0)),"radio"===i.datatype&&(e=r="",p(i.data_selector).is(":checked")&&(r=!0),r&&(e=p(i.data_selector+":checked").val())),"select"===i.datatype&&(e=p(i.data_selector).val()),"buttonform"===i.datatype&&(e="confirmed");var r,t=p(this).attr("data-nonce"),a=p(this).attr("data-prime-mover-blogid-panel");!0===i.dialog?(r=i.dialog_selector,m.showDialogHandler(r,t,i.dialog_button_text,"prime-mover-deleteall-button",o,i.ajax_action,i.ajax_key,e,prime_mover_control_panel_renderer.prime_mover_cancel_button,i.data_selector,a)):m.isDoingAjax(o)||(m.triggerProcessing(o),(t=m.defineGenericData(i.ajax_action,t))[i.ajax_key]=e,a&&(t.prime_mover_panel_js_blogid=a),m.doAjaxRequest(t,o,i.data_selector))})})},initializeAutoBackupBlogSelector:function(){p("body").on("click",".js-prime-mover-clear-site",function(e){p(".js-prime-mover-site-selector").val("")}),p(".js-prime-mover-site-selector").change(function(){p(this).closest("form").submit()})},showDialogHandler:function(e,r,o,t,a,i,n,s,_,l,c){void 0===l&&(l=""),void 0===c&&(c=""),p(e).dialog({resizable:!1,height:"auto",minWidth:320,maxWidth:600,dialogClass:"prime-mover-user-dialog",modal:!0,fluid:!0,buttons:[{text:o,class:t,click:function(){p(this).dialog("close");var e=a;m.triggerProcessing(e);var o=m.defineGenericData(i,r);o[n]=s,c&&(o.prime_mover_panel_js_blogid=c),m.doAjaxRequest(o,e,l)}},{text:_,click:function(){p(this).dialog("close")}}]}),m.handle_responsive_dialog()},doAjaxRequest:function(e,a,r){void 0===r&&(r=""),m.doing_ajax[a]=!0,p.post(ajaxurl,e,function(e){var o;p(a).html(e.message),"saved_settings"in e&&r&&(o=e.saved_settings,m.executeOtherAfterSavedHooks(r,o),p(r).val(o)),e.save_status?p(a).addClass("notice notice-success"):o?p(a).addClass("notice notice-warning"):p(a).addClass("notice notice-error"),m.doing_ajax[a]=!1,"reload"in e&&!0===e.reload&&location.reload()}).fail(function(e,o,r){var t=prime_mover_control_panel_renderer.prime_mover_panel_error;r&&o&&(t=(o=o.toUpperCase())+": "+r),p(a).html(t),p(a).addClass("notice notice-error"),m.doing_ajax[a]=!1})},doing_ajax:[],isDoingAjax:function(e){return e in m.doing_ajax&&m.doing_ajax[e]},toggleDropBoxToken:function(){var o="#js-prime_mover_dropbox_access_key";p("body").on("click","#js-prime_mover_dropbox_token_checkbox",function(){var e="conceal-authorization-keys";p(o).hasClass(e)?p(o).removeClass(e):p(o).addClass(e)})},toggleEncryptionKey:function(){var o="#js-prime_mover_encryption_key_panel";p("body").on("click","#js-prime_mover_encryption_key_panel_checkbox",function(){var e="conceal-authorization-keys";p(o).hasClass(e)?p(o).removeClass(e):p(o).addClass(e)})},toggleMySQLDumpConfigPath:function(){var o="#js-prime_mover_mysqldump_cnf_setting";p("body").on("click","#js-prime_mover_mysqldump_cnf_checkbox",function(){var e="conceal-authorization-keys";p(o).hasClass(e)?p(o).removeClass(e):p(o).addClass(e)})},showHideAuthorizationKeys:function(){var e="#js-prime-mover-authorized-domains",o="conceal-authorization-keys";p("body").on("click","#js-prime_mover_edit_authorization_keys",function(){p(e).hasClass(o)?p(e).removeClass(o):p(e).addClass(o)})},showHideGDriveCredentials:function(){var e="#js-prime-mover-gdrive-settings",o="conceal-authorization-keys";p("body").on("click","#js-prime_mover_edit_gdrive",function(){p(e).hasClass(o)?p(e).removeClass(o):p(e).addClass(o)})},generateAuthorizationKey:function(){p("body").on("click","#js-prime-mover-autogenerate-key",function(){for(var e=prime_mover_control_panel_renderer.prime_mover_host_domain,o=e+":"+m.randomString(),r=".js-prime-mover-copy-key",t="#js-prime-mover-authorized-domains",a=p.trim(p(t).val()).replace(/ /g,"").split("\n").filter(function(e){return 0!==e.length&&null!==e}),i=a.length,n=[],s=0;s<i;s++){var _=a[s];-1!==_.indexOf(":")&&(_=_.split(":")[0],n.push(_),_===e&&(m.authorizationKeyClipBoardHandler(r,o),a[s]=o))}-1===p.inArray(e,n)&&(m.authorizationKeyClipBoardHandler(r,o),a.push(o));var l=a.join("\n");p(t).val(l)})},authorizationKeyClipBoardHandler:function(e,o){var r=p(e).attr("data-saved-value");p(e).attr("data-clipboard-text",o),r!==o&&p(".js-prime-mover-copy-key").hide()},copyKeyToClipBoard:function(){this.clipBoardHelper(".js-prime-mover-copy-key","#js-prime-mover-clipboard-key-confirmation")},copyEncryptionKeyToClipBoard:function(){this.clipBoardHelper(".js-prime-mover-copy-encryption-key","#js-prime-mover-clipboard-encryption-key-confirmation")},clipBoardHelper:function(e,o){new ClipboardJS(e).on("success",function(e){p(o).fadeIn("fast").delay(3e3).fadeOut()})},randomString:function(){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",o="",r=64;0<r;--r)o+=e[Math.floor(Math.random()*e.length)];return o},triggerProcessing:function(e){var o='<img src="'+prime_mover_control_panel_renderer.prime_mover_settings_ajax_spinner_gif+'" />';p(e).html(o),p(e).removeClass("notice notice-error"),p(e).removeClass("notice notice-success"),p(e).removeClass("notice notice-warning")},computeBackupDirSize:function(){p("body").on("click","#js-prime-mover-backup-directory-size-button",function(){var e,o=".js-prime-mover-backup-directory-size-spinner";m.isDoingAjax(o)||(m.triggerProcessing(o),e=p(this).attr("data-nonce"),(e=m.defineGenericData("prime_mover_computedir_size",e)).compute_dir_size="yes",m.doAjaxRequest(e,o))})},clearLogs:function(){p("body").on("click","#js-clear-prime-mover-troubleshooting",function(){var e=p(this).attr("data-nonce");m.showDialogHandler("#js-prime-mover-panel-clearall-dialog",e,prime_mover_control_panel_renderer.prime_mover_clearall_button,"prime-mover-deleteall-button",".js-save-prime-mover-clear-log-spinner","prime_mover_clear_troubleshooting_log","clear_confirmation","clearlog",prime_mover_control_panel_renderer.prime_mover_cancel_button)})},deleteAllBackups:function(){p("body").on("click","#js-delete_all_backup_zips_network",function(){var e=p(this).attr("data-nonce");m.showDialogHandler("#js-prime-mover-panel-deleteall-dialog",e,prime_mover_control_panel_renderer.prime_mover_delete_continue_button,"prime-mover-deleteall-button",".js-delete_all_backup_zips_network-spinner","prime_mover_delete_all_backups_request","delete_confirmation","yes",prime_mover_control_panel_renderer.prime_mover_cancel_button)})},resetToDefaults:function(){p("body").on("click","#js-prime-mover-reset-settings",function(){var e=p(this).attr("data-nonce");m.showDialogHandler("#js-prime-mover-panel-resettodefault-dialog",e,prime_mover_control_panel_renderer.prime_mover_delete_continue_button,"prime-mover-deleteall-button",".js-reset-back-to-defaults-migration-spinner","prime_mover_reset_settings","reset_confirmation","yes",prime_mover_control_panel_renderer.prime_mover_cancel_button)})},fluidDialog:function(){p(".ui-dialog:visible").each(function(){var e,o=p(this),r=o.find(".ui-dialog-content").data("ui-dialog");r.options.fluid&&(p(window).width()<parseInt(r.options.maxWidth)+50?o.css("max-width","90%"):(e=.9*parseInt(r.options.maxWidth),o.css("max-width",e+"px")),r.option("position",r.options.position))})},handle_responsive_dialog:function(){p(window).resize(function(){m.fluidDialog()}),m.fluidDialog()},defineGenericData:function(e,o){return{action:e,dataType:"json",savenonce:o}},executeOtherAfterSavedHooks:function(e,o){"#js-prime-mover-authorized-domains"===e&&m.showClipBoardButtonWhenSiteKeyExist(o)},slideTogglerActivatedPlugins:function(){var e="#js-prime-mover-toggle-activated-plugins";p("body").on("click",e,function(){p("#js-prime-mover-activated-plugins-helper").slideToggle("fast",function(){p(this).is(":visible")?p(e).text(prime_mover_control_panel_renderer.prime_mover_close_text):p(e).text(prime_mover_control_panel_renderer.prime_mover_expand_text)})}),p("#js-prime-mover-activated-plugins-helper input:checkbox").change(function(){var e=p("#js-prime-mover-activated-plugins-helper input:checkbox:checked").map(function(){return p(this).val()}).get().join("\n");p("#js-prime-mover-excluded-plugins").val(e)})},showClipBoardButtonWhenSiteKeyExist:function(e){var o=!1,e=p.trim(e);if(e){for(var r=prime_mover_control_panel_renderer.prime_mover_host_domain,t=e.split("\n").filter(function(e){return 0!==e.length&&null!==e}),a=t.length,i=0;i<a;i++){var n=t[i];-1!==n.indexOf(":")&&n.split(":")[0]===r&&(o=!0,p(".js-prime-mover-copy-key").show())}!1===o&&p(".js-prime-mover-copy-key").hide()}else p(".js-prime-mover-copy-key").hide()}}}(jQuery);